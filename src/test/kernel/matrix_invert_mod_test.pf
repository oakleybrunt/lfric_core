!-------------------------------------------------------------------------------
! (c) The copyright relating to this work is owned jointly by the Crown, 
! Met Office and NERC 2014. 
! However, it has been created with the help of the GungHo Consortium, 
! whose members are identified at https://puma.nerc.ac.uk/trac/GungHo/wiki
!-------------------------------------------------------------------------------
!
!-------------------------------------------------------------------------------
module matrix_invert_mod_test
  implicit none 

contains

  @test
  subroutine test_of_matrix_invert()
    use pFUnit_Mod
    use matrix_invert_mod, only : matrix_invert
    use constants_mod, only : dp
    implicit none

    real(kind=dp) :: a(4,4),a_inv(4,4),answer(4,4)
    real(kind=dp) :: tol,one

    ! This uses 2D P1_DG mass matrix as an example
    a(1,:) = 1.0_dp/9.0_dp*(/ 4.0_dp, 2.0_dp, 2.0_dp, 1.0_dp /)
    a(2,:) = 1.0_dp/9.0_dp*(/ 2.0_dp, 4.0_dp, 1.0_dp, 2.0_dp /)
    a(3,:) = 1.0_dp/9.0_dp*(/ 2.0_dp, 1.0_dp, 4.0_dp, 2.0_dp /)
    a(4,:) = 1.0_dp/9.0_dp*(/ 1.0_dp, 2.0_dp, 2.0_dp, 4.0_dp /)

    call matrix_invert(a,a_inv,4)

    answer = matmul(a,a_inv)

    tol=1.0e-14
    one = 1.0_dp

    @assertEqual( one, answer(1,1), tol )
    @assertEqual( one, answer(2,2), tol )
    @assertEqual( one, answer(3,3), tol )
    @assertEqual( one, answer(4,4), tol )

  end subroutine test_of_matrix_invert

end module matrix_invert_mod_test
